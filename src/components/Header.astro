---
import { instagramAnyelLink } from '../utils';
---

<header
    class="fixed top-8 left-1/2 -translate-x-1/2 w-4/5 flex justify-center items-center z-50 text-primary-foreground"
>
    <div
        class="w-full max-w-[900px] flex items-center justify-between rounded-2xl backdrop-blur-md border border-white/20 shadow-lg px-10 py-2"
    >
        <nav class="w-1/3">
            <ul
                class="w-full flex items-center md:gap-5 gap-0 justify-around
         [&>li>a]:py-2 md:[&>li>a]:px-9 [&>li>a]:px-4
         [&>li>a]:rounded-full
         [&>li>a]:text-gray-300
         [&>li>a]:transition-colors [&>li>a]:duration-200"
            >
                <li><a href="#initial">Início</a></li>
                <li><a href="#projects">Projetos</a></li>
                <li><a href="#about">Sobre</a></li>
            </ul>
        </nav>

        <a
            href={instagramAnyelLink()}
            target="_blank"
            rel="noopener noreferrer"
            class="relative"
        >
            <img
                src="/photo-profile.jpg"
                alt="Foto de perfil de Carlos Anyel"
                class="w-12 h-12 rounded-xl object-cover"
            />
            <div
                class="w-3 h-3 bg-green-600 rounded-full absolute -top-1 -right-1"
            >
            </div>
        </a>
    </div>
</header>

<script is:inline>
    document.addEventListener('DOMContentLoaded', () => {
        const sections = document.querySelectorAll('section[id]');
        const navLinks = document.querySelectorAll('nav ul li a');

        let ignoreObserver = false;

        function setActive(id) {
            navLinks.forEach(link => {
                if (link.getAttribute('href') === `#${id}`) {
                    link.classList.add('bg-accent');
                } else {
                    link.classList.remove('bg-accent');
                }
            });
        }

        navLinks.forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                const id = link.getAttribute('href').substring(1);
                const section = document.getElementById(id);

                if (section) {
                    ignoreObserver = true;
                    section.scrollIntoView();
                    setActive(id);

                    setTimeout(() => (ignoreObserver = false), 500);
                }
            });
        });

        // Scrollspy
        const observer = new IntersectionObserver(
            entries => {
                if (ignoreObserver) return;

                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        setActive(entry.target.id);
                    }
                });
            },
            { threshold: 0.5 } // 50% da seção visível
        );

        sections.forEach(section => observer.observe(section));
    });
</script>
